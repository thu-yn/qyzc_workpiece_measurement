# key_anglesæ•°ç»„å‚è€ƒæ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜Žäº†æœ¬ç³»ç»Ÿä¸­`key_angles`æ•°ç»„åœ¨ä¸åŒå¤„ç†æ¨¡å¼ä¸‹çš„å«ä¹‰å’Œç”¨é€”ã€‚

## ðŸ“‹ æ¦‚è¿°

`key_angles`æ•°ç»„æ˜¯å§¿æ€æµ‹é‡ç³»ç»Ÿçš„æ ¸å¿ƒè¾“å‡ºä¹‹ä¸€ï¼ŒåŒ…å«äº†å¤šç§è§’åº¦æµ‹é‡ä¿¡æ¯ã€‚æ ¹æ®ç³»ç»Ÿè¿è¡Œæ¨¡å¼çš„ä¸åŒï¼Œè¯¥æ•°ç»„çš„é•¿åº¦å’Œå†…å®¹ä¼šæœ‰æ‰€å·®å¼‚ï¼š

- **åŸºç¡€æ¨¡å¼**ï¼š8ä¸ªè§’åº¦å€¼ï¼ˆç´¢å¼•0-7ï¼‰
- **æ‰©å±•æ¨¡å¼**ï¼š20ä¸ªè§’åº¦å€¼ï¼ˆç´¢å¼•0-19ï¼‰

æ‰€æœ‰è§’åº¦å€¼å‡ä»¥**å¼§åº¦**ä¸ºå•ä½å­˜å‚¨ï¼Œåœ¨CSVè¾“å‡ºæ—¶ä¼šè½¬æ¢ä¸º**åº¦æ•°**ã€‚

---

## ðŸ”§ åŸºç¡€æ¨¡å¼ï¼ˆBasic Modeï¼‰

**æ¡ä»¶**ï¼š`enable_advanced_measurements = false`

**æ•°ç»„é•¿åº¦**ï¼š8ä¸ªå…ƒç´ 

**æ•°æ®æ¥æº**ï¼š`calculateWorkpieceRelativeAngles`å‡½æ•°

### è§’åº¦å®šä¹‰

| ç´¢å¼• | å«ä¹‰ | è®¡ç®—æ–¹æ³• | å¤‡æ³¨ |
|------|------|----------|------|
| `key_angles[0]` | Rollç»å¯¹å€¼åå·® | `abs(euler_angles.x())` | ç›®æ ‡ç‚¹äº‘ç›¸å¯¹å‚è€ƒç‚¹äº‘ç»•Xè½´çš„æ—‹è½¬åå·® |
| `key_angles[1]` | Pitchç»å¯¹å€¼åå·® | `abs(euler_angles.y())` | ç›®æ ‡ç‚¹äº‘ç›¸å¯¹å‚è€ƒç‚¹äº‘ç»•Yè½´çš„æ—‹è½¬åå·® |
| `key_angles[2]` | Yawç»å¯¹å€¼åå·® | `abs(euler_angles.z())` | ç›®æ ‡ç‚¹äº‘ç›¸å¯¹å‚è€ƒç‚¹äº‘ç»•Zè½´çš„æ—‹è½¬åå·® |
| `key_angles[3]` | æ€»æ—‹è½¬åå·® | `abs(angle_axis.angle())` | è½´è§’è¡¨ç¤ºçš„ç­‰æ•ˆå•è½´æ—‹è½¬è§’åº¦ |
| `key_angles[4]` | æ—‹è½¬è½´ä¸ŽXè½´å¤¹è§’ | `acos(abs(rotation_axis.x()))` | æ—‹è½¬è½´æ–¹å‘ä¸ŽXè½´çš„å¤¹è§’ |
| `key_angles[5]` | æ—‹è½¬è½´ä¸ŽYè½´å¤¹è§’ | `acos(abs(rotation_axis.y()))` | æ—‹è½¬è½´æ–¹å‘ä¸ŽYè½´çš„å¤¹è§’ |
| `key_angles[6]` | æ—‹è½¬è½´ä¸ŽZè½´å¤¹è§’ | `acos(abs(rotation_axis.z()))` | æ—‹è½¬è½´æ–¹å‘ä¸ŽZè½´çš„å¤¹è§’ |
| `key_angles[7]` | ç»¼åˆåå·®æŒ‡æ ‡ | `sqrt(rollÂ² + pitchÂ² + yawÂ²)` | ä¸‰ä¸ªæ¬§æ‹‰è§’çš„æ¬§å‡ é‡Œå¾—èŒƒæ•° |

### åº”ç”¨åœºæ™¯

åŸºç¡€æ¨¡å¼é€‚ç”¨äºŽï¼š
- å¿«é€Ÿå§¿æ€è¯„ä¼°
- å®žæ—¶è´¨é‡æ£€æµ‹
- ç®€å•çš„åå·®åˆ†æž
- æ‰¹é‡å¤„ç†åœºæ™¯

---

## ðŸš€ æ‰©å±•æ¨¡å¼ï¼ˆAdvanced Modeï¼‰

**æ¡ä»¶**ï¼š`enable_advanced_measurements = true`

**æ•°ç»„é•¿åº¦**ï¼š20ä¸ªå…ƒç´ 

**æ•°æ®æ¥æº**ï¼šç»“åˆäº†å‡ ä½•ç‰¹å¾åˆ†æžå’Œå§¿æ€åå·®è®¡ç®—

### è§’åº¦å®šä¹‰

#### ðŸ“Š å‡ ä½•ç‰¹å¾è§’åº¦ï¼ˆç´¢å¼•0-11ï¼‰

**æ¥æº**ï¼š`MeasurementCalculator::calculateCharacteristicAngles`

**ä¸»è½´ä¸Žåæ ‡è½´å¤¹è§’ï¼š**

| ç´¢å¼• | å«ä¹‰ | è®¡ç®—å¯¹è±¡ |
|------|------|----------|
| `key_angles[0]` | ä¸»è½´1ä¸ŽXè½´åå·® | ç¬¬ä¸€ä¸»è½´ï¼ˆæœ€å¤§ç‰¹å¾å‘é‡ï¼‰ä¸ŽXè½´å¤¹è§’ |
| `key_angles[1]` | ä¸»è½´1ä¸ŽYè½´åå·® | ç¬¬ä¸€ä¸»è½´ä¸ŽYè½´å¤¹è§’ |
| `key_angles[2]` | ä¸»è½´1ä¸ŽZè½´åå·® | ç¬¬ä¸€ä¸»è½´ä¸ŽZè½´å¤¹è§’ |
| `key_angles[3]` | ä¸»è½´2ä¸ŽXè½´åå·® | ç¬¬äºŒä¸»è½´ï¼ˆä¸­ç­‰ç‰¹å¾å‘é‡ï¼‰ä¸ŽXè½´å¤¹è§’ |
| `key_angles[4]` | ä¸»è½´2ä¸ŽYè½´åå·® | ç¬¬äºŒä¸»è½´ä¸ŽYè½´å¤¹è§’ |
| `key_angles[5]` | ä¸»è½´2ä¸ŽZè½´åå·® | ç¬¬äºŒä¸»è½´ä¸ŽZè½´å¤¹è§’ |
| `key_angles[6]` | ä¸»è½´3ä¸ŽXè½´åå·® | ç¬¬ä¸‰ä¸»è½´ï¼ˆæœ€å°ç‰¹å¾å‘é‡ï¼‰ä¸ŽXè½´å¤¹è§’ |
| `key_angles[7]` | ä¸»è½´3ä¸ŽYè½´åå·® | ç¬¬ä¸‰ä¸»è½´ä¸ŽYè½´å¤¹è§’ |
| `key_angles[8]` | ä¸»è½´3ä¸ŽZè½´åå·® | ç¬¬ä¸‰ä¸»è½´ä¸ŽZè½´å¤¹è§’ |

**ä¸»è½´ä¹‹é—´çš„å¤¹è§’ï¼š**

| ç´¢å¼• | å«ä¹‰ | è®¡ç®—æ–¹æ³• |
|------|------|----------|
| `key_angles[9]` | ä¸»è½´1ä¸Žä¸»è½´2åå·® | `acos(abs(axis1.dot(axis2)))` |
| `key_angles[10]` | ä¸»è½´1ä¸Žä¸»è½´3åå·® | `acos(abs(axis1.dot(axis3)))` |
| `key_angles[11]` | ä¸»è½´2ä¸Žä¸»è½´3åå·® | `acos(abs(axis2.dot(axis3)))` |

#### ðŸ“Š å§¿æ€åå·®è§’åº¦ï¼ˆç´¢å¼•12-19ï¼‰

**æ¥æº**ï¼š`calculateWorkpieceRelativeAngles`å‡½æ•°

| ç´¢å¼• | å«ä¹‰ | è®¡ç®—æ–¹æ³• | å¤‡æ³¨ |
|------|------|----------|------|
| `key_angles[12]` | Rollç»å¯¹å€¼åå·® | `abs(euler_angles.x())` | ä¸ŽåŸºç¡€æ¨¡å¼ç›¸åŒ |
| `key_angles[13]` | Pitchç»å¯¹å€¼åå·® | `abs(euler_angles.y())` | ä¸ŽåŸºç¡€æ¨¡å¼ç›¸åŒ |
| `key_angles[14]` | Yawç»å¯¹å€¼åå·® | `abs(euler_angles.z())` | ä¸ŽåŸºç¡€æ¨¡å¼ç›¸åŒ |
| `key_angles[15]` | æ€»æ—‹è½¬åå·® | `abs(angle_axis.angle())` | ä¸ŽåŸºç¡€æ¨¡å¼ç›¸åŒ |
| `key_angles[16]` | æ—‹è½¬è½´ä¸ŽXè½´å¤¹è§’ | `acos(abs(rotation_axis.x()))` | ä¸ŽåŸºç¡€æ¨¡å¼ç›¸åŒ |
| `key_angles[17]` | æ—‹è½¬è½´ä¸ŽYè½´å¤¹è§’ | `acos(abs(rotation_axis.y()))` | ä¸ŽåŸºç¡€æ¨¡å¼ç›¸åŒ |
| `key_angles[18]` | æ—‹è½¬è½´ä¸ŽZè½´å¤¹è§’ | `acos(abs(rotation_axis.z()))` | ä¸ŽåŸºç¡€æ¨¡å¼ç›¸åŒ |
| `key_angles[19]` | ç»¼åˆåå·®æŒ‡æ ‡ | `sqrt(rollÂ² + pitchÂ² + yawÂ²)` | ä¸ŽåŸºç¡€æ¨¡å¼ç›¸åŒ |

### åº”ç”¨åœºæ™¯

æ‰©å±•æ¨¡å¼é€‚ç”¨äºŽï¼š
- è¯¦ç»†çš„å‡ ä½•åˆ†æž
- å¤æ‚å½¢çŠ¶ç‰©ä½“çš„æµ‹é‡
- ç§‘ç ”å’Œå¼€å‘åœºæ™¯
- éœ€è¦å®Œæ•´ç‰¹å¾æè¿°çš„åº”ç”¨

---

## ðŸ“ CSVè¾“å‡ºå¯¹åº”å…³ç³»

åœ¨CSVæ–‡ä»¶ä¸­ï¼Œæ ¹æ®ä¸åŒæ¨¡å¼ä¼šé€‰æ‹©æ€§è¾“å‡º`key_angles`çš„éƒ¨åˆ†å†…å®¹ï¼š

### åŸºç¡€æ¨¡å¼CSVè¾“å‡º

```cpp
// å¯¹åº” key_angles[0-7]
if (data.key_angles.size() >= 8) {
    file << data.key_angles[0] * 180.0 / M_PI << ","   // Rollåå·®
         << data.key_angles[1] * 180.0 / M_PI << ","   // Pitchåå·®
         << data.key_angles[2] * 180.0 / M_PI << ","   // Yawåå·®
         << data.key_angles[3] * 180.0 / M_PI << ","   // æ€»æ—‹è½¬åå·®
         << data.key_angles[7] * 180.0 / M_PI << ",";  // ç»¼åˆåå·®
}
```

### æ‰©å±•æ¨¡å¼CSVè¾“å‡º

```cpp
// å¯¹åº” key_angles[12-19]
if (enable_advanced_processing_ && data.key_angles.size() >= 20) {
    file << data.key_angles[12] * 180.0 / M_PI << ","  // Rollåå·®
         << data.key_angles[13] * 180.0 / M_PI << ","  // Pitchåå·®
         << data.key_angles[14] * 180.0 / M_PI << ","  // Yawåå·®
         << data.key_angles[15] * 180.0 / M_PI << ","  // æ€»æ—‹è½¬åå·®
         << data.key_angles[19] * 180.0 / M_PI << ","; // ç»¼åˆåå·®
}
```

---

## ðŸ” é‡è¦è¯´æ˜Ž

### å•ä½è½¬æ¢

- **å­˜å‚¨å•ä½**ï¼šå¼§åº¦ï¼ˆradï¼‰
- **æ˜¾ç¤ºå•ä½**ï¼šåº¦ï¼ˆÂ°ï¼‰
- **è½¬æ¢å…¬å¼**ï¼š`åº¦ = å¼§åº¦ Ã— 180 / Ï€`

### è§’åº¦å«ä¹‰

1. **åå·®è§’åº¦**ï¼ˆç´¢å¼•12-14, 0-2ï¼‰ï¼šè¡¨ç¤ºç›®æ ‡ç‰©ä½“ç›¸å¯¹å‚è€ƒç‰©ä½“çš„å§¿æ€å·®å¼‚
2. **å‡ ä½•è§’åº¦**ï¼ˆç´¢å¼•0-11ï¼‰ï¼šæè¿°ç‰©ä½“å‡ ä½•å½¢çŠ¶çš„ç©ºé—´æ–¹å‘ç‰¹å¾
3. **æ—‹è½¬è½´è§’åº¦**ï¼ˆç´¢å¼•16-18, 4-6ï¼‰ï¼šæè¿°ç­‰æ•ˆæ—‹è½¬è½´çš„ç©ºé—´æ–¹å‘
4. **ç»¼åˆæŒ‡æ ‡**ï¼ˆç´¢å¼•19, 7ï¼‰ï¼šç”¨äºŽæ•´ä½“è´¨é‡è¯„ä¼°çš„å•ä¸€æ•°å€¼

### åº”ç”¨å»ºè®®

- **è´¨é‡æ£€æµ‹**ï¼šä¸»è¦å…³æ³¨åå·®è§’åº¦ï¼ˆroll, pitch, yawï¼‰å’Œç»¼åˆæŒ‡æ ‡
- **å½¢çŠ¶åˆ†æž**ï¼šä½¿ç”¨å‡ ä½•è§’åº¦åˆ†æžç‰©ä½“çš„ä¸»è½´æ–¹å‘
- **æ—‹è½¬åˆ†æž**ï¼šé€šè¿‡æ—‹è½¬è½´è§’åº¦ç†è§£å˜æ¢çš„æœ¬è´¨
- **è‡ªåŠ¨åŒ–æŽ§åˆ¶**ï¼šæ ¹æ®åå·®è§’åº¦ä¸ºæœºæ¢°è‡‚æä¾›çº æ­£å‚æ•°

### æ•°å€¼èŒƒå›´

- **è§’åº¦èŒƒå›´**ï¼š0Â° - 180Â°ï¼ˆä½¿ç”¨ç»å¯¹å€¼ï¼‰
- **ç‰¹æ®Šå€¼**ï¼š90Â°è¡¨ç¤ºåž‚ç›´å…³ç³»
- **è´¨é‡é˜ˆå€¼**ï¼šé€šå¸¸å°äºŽ5Â°ä¸ºé«˜ç²¾åº¦ï¼Œå°äºŽ30Â°ä¸ºå¯æŽ¥å—

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [pose_estimator.h](../include/pose_measurement/pose_estimator.h) - å§¿æ€ä¼°è®¡å™¨æŽ¥å£å®šä¹‰
- [measurement_calculator.h](../include/pose_measurement/measurement_calculator.h) - å‡ ä½•æµ‹é‡è®¡ç®—å™¨æŽ¥å£
- [pose_measurement_node.cpp](../src/pose_measurement_node.cpp) - CSVè¾“å‡ºå®žçŽ°
- [README.md](../README.md) - é¡¹ç›®å®Œæ•´æ–‡æ¡£

---

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»thu.yangnan@outlook.comã€‚